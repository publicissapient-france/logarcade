<!DOCTYPE html>
<html>
<head>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.0.0/dist/phaser.min.js"></script>
    <title>LogArcade</title>
</head>
<body>

<script>

    const logos = [
        {name: 'Angular', file: 'angular.png'},
        {name: 'EmberJS', file: 'ember.png'},
        {name: 'React', file: 'react.png'},
        {name: 'VueJS', file: 'vue.png'},
    ];

    const config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        scene: {
            preload: preload,
            create: create,
            update: update,
        }
    };

    function onKeyDown(text) {
        text.setTint(0xff00ff, 0xffff00, 0x0000ff, 0xff0000);
        text.setFontSize(32);
        setTimeout(() => {
            text.clearTint();
            text.setFontSize(16);
        }, 150);
    }

    class Player {
        constructor() {
            this.score = 0;
            this.buttons = {};
            this.game = {
                buttons: {}
            }
        }

        setBoutons(A, B, C, D, START) {
            this.buttons.A = Phaser.Input.Keyboard.KeyCodes[A];
            this.buttons.B = Phaser.Input.Keyboard.KeyCodes[B];
            this.buttons.C = Phaser.Input.Keyboard.KeyCodes[C];
            this.buttons.D = Phaser.Input.Keyboard.KeyCodes[D];
            this.buttons.START = Phaser.Input.Keyboard.KeyCodes[START];
        }

        preload(game) {
            this.game.buttons.A = game.input.keyboard.addKey(this.buttons.A);
            this.game.buttons.B = game.input.keyboard.addKey(this.buttons.B);
            this.game.buttons.C = game.input.keyboard.addKey(this.buttons.C);
            this.game.buttons.D = game.input.keyboard.addKey(this.buttons.D);
            this.game.buttons.START = game.input.keyboard.addKey(this.buttons.START);
        }

        update(hud) {
            if (Phaser.Input.Keyboard.JustDown(this.game.buttons.A)) {
                onKeyDown(hud.text1);
            }
            if (Phaser.Input.Keyboard.JustDown(this.game.buttons.B)) {
                onKeyDown(hud.text2);
            }
            if (Phaser.Input.Keyboard.JustDown(this.game.buttons.C)) {
                onKeyDown(hud.text3);
            }
            if (Phaser.Input.Keyboard.JustDown(this.game.buttons.D)) {
                onKeyDown(hud.text4);
            }
            if (Phaser.Input.Keyboard.JustDown(this.game.buttons.START)) {
                console.log('P1');
            }
        }
    }

    const INITIAL_REMAINING_TIME = 99;

    class Hud {
        constructor() {
            this.remainingTime = INITIAL_REMAINING_TIME;
        }

        preload(game) {
            logos.forEach(l => game.load.image(l.name, `assets/logos/${l.file}`));
        }

        create(game) {
            this.time = game.add.text(400, 50, this.remainingTime);
            this.logo = game.add.image(400, 300, 'Angular');
            this.text1 = game.add.text(100, 500, 'Angular');
            this.text2 = game.add.text(200, 500, 'VueJS');
            this.text3 = game.add.text(300, 500, 'React');
            this.text4 = game.add.text(400, 500, 'EmberJS');
        }

        start() {
            this.start = new Date();
        }

        update() {
            const elapsedTime = (new Date().getTime() - this.start.getTime()) / 1000;
            this.remainingTime = Math.round(INITIAL_REMAINING_TIME - elapsedTime);
            this.time.setText(this.remainingTime);
        }
    }

    const player1 = new Player();
    player1.setBoutons('A', 'Z', 'E', 'T', 'SPACE');

    const hud = new Hud();

    const game = new Phaser.Game(config);

    function preload() {
        hud.preload(this);
        this.load.audio('theme', [
            'assets/audio/Retroj채b채_-_Retroj채b채_-_sbrp_tutorial_remix.mp3'
        ]);
        player1.preload(this);
    }

    function create() {
        hud.create(this);
        var music = this.sound.add('theme');
        music.play();
        hud.start();
    }

    function update() {
        player1.update(hud);
        hud.update();
    }
</script>

</body>
</html>